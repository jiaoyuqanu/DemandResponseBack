<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xqxy.dr.modular.event.mapper.EventPowerMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.xqxy.dr.modular.event.entity.EventPower">
        <id column="data_id" property="dataId" />
        <result column="event_id" property="eventId" />
        <result column="data_date" property="dataDate" />
        <result column="data_point_flag" property="dataPointFlag" />
        <result column="p1" property="p1" />
        <result column="p2" property="p2" />
        <result column="p3" property="p3" />
        <result column="p4" property="p4" />
        <result column="p5" property="p5" />
        <result column="p6" property="p6" />
        <result column="p7" property="p7" />
        <result column="p8" property="p8" />
        <result column="p9" property="p9" />
        <result column="p10" property="p10" />
        <result column="p11" property="p11" />
        <result column="p12" property="p12" />
        <result column="p13" property="p13" />
        <result column="p14" property="p14" />
        <result column="p15" property="p15" />
        <result column="p16" property="p16" />
        <result column="p17" property="p17" />
        <result column="p18" property="p18" />
        <result column="p19" property="p19" />
        <result column="p20" property="p20" />
        <result column="p21" property="p21" />
        <result column="p22" property="p22" />
        <result column="p23" property="p23" />
        <result column="p24" property="p24" />
        <result column="p25" property="p25" />
        <result column="p26" property="p26" />
        <result column="p27" property="p27" />
        <result column="p28" property="p28" />
        <result column="p29" property="p29" />
        <result column="p30" property="p30" />
        <result column="p31" property="p31" />
        <result column="p32" property="p32" />
        <result column="p33" property="p33" />
        <result column="p34" property="p34" />
        <result column="p35" property="p35" />
        <result column="p36" property="p36" />
        <result column="p37" property="p37" />
        <result column="p38" property="p38" />
        <result column="p39" property="p39" />
        <result column="p40" property="p40" />
        <result column="p41" property="p41" />
        <result column="p42" property="p42" />
        <result column="p43" property="p43" />
        <result column="p44" property="p44" />
        <result column="p45" property="p45" />
        <result column="p46" property="p46" />
        <result column="p47" property="p47" />
        <result column="p48" property="p48" />
        <result column="p49" property="p49" />
        <result column="p50" property="p50" />
        <result column="p51" property="p51" />
        <result column="p52" property="p52" />
        <result column="p53" property="p53" />
        <result column="p54" property="p54" />
        <result column="p55" property="p55" />
        <result column="p56" property="p56" />
        <result column="p57" property="p57" />
        <result column="p58" property="p58" />
        <result column="p59" property="p59" />
        <result column="p60" property="p60" />
        <result column="p61" property="p61" />
        <result column="p62" property="p62" />
        <result column="p63" property="p63" />
        <result column="p64" property="p64" />
        <result column="p65" property="p65" />
        <result column="p66" property="p66" />
        <result column="p67" property="p67" />
        <result column="p68" property="p68" />
        <result column="p69" property="p69" />
        <result column="p70" property="p70" />
        <result column="p71" property="p71" />
        <result column="p72" property="p72" />
        <result column="p73" property="p73" />
        <result column="p74" property="p74" />
        <result column="p75" property="p75" />
        <result column="p76" property="p76" />
        <result column="p77" property="p77" />
        <result column="p78" property="p78" />
        <result column="p79" property="p79" />
        <result column="p80" property="p80" />
        <result column="p81" property="p81" />
        <result column="p82" property="p82" />
        <result column="p83" property="p83" />
        <result column="p84" property="p84" />
        <result column="p85" property="p85" />
        <result column="p86" property="p86" />
        <result column="p87" property="p87" />
        <result column="p88" property="p88" />
        <result column="p89" property="p89" />
        <result column="p90" property="p90" />
        <result column="p91" property="p91" />
        <result column="p92" property="p92" />
        <result column="p93" property="p93" />
        <result column="p94" property="p94" />
        <result column="p95" property="p95" />
        <result column="p96" property="p96" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        data_id, event_id, data_date, data_point_flag, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15, p16, p17, p18, p19, p20, p21, p22, p23, p24, p25, p26, p27, p28, p29, p30, p31, p32, p33, p34, p35, p36, p37, p38, p39, p40, p41, p42, p43, p44, p45, p46, p47, p48, p49, p50, p51, p52, p53, p54, p55, p56, p57, p58, p59, p60, p61, p62, p63, p64, p65, p66, p67, p68, p69, p70, p71, p72, p73, p74, p75, p76, p77, p78, p79, p80, p81, p82, p83, p84, p85, p86, p87, p88, p89, p90, p91, p92, p93, p94, p95, p96
    </sql>
    <select id="getEventPowerBase" resultType="com.xqxy.dr.modular.event.result.EventPowerResult" parameterType="com.xqxy.dr.modular.event.param.EventParam">
        select
            data_date dataDate,
            max_load_baseline,
            max_load_baseline,
            min_load_baseline,
            p1, p2, p3, p4, p5, p6, p7, p8, p9, p10,
            p11, p12, p13, p14, p15, p16, p17, p18, p19,
            p20, p21, p22, p23, p24, p25, p26, p27, p28,
            p29, p30, p31, p32, p33, p34, p35, p36, p37,
            p38, p39, p40, p41, p42, p43, p44, p45, p46,
            p47, p48, p49, p50, p51, p52, p53, p54, p55,
            p56, p57, p58, p59, p60, p61, p62, p63, p64,
            p65, p66, p67, p68, p69, p70, p71, p72, p73,
            p74, p75, p76, p77, p78, p79, p80, p81, p82,
            p83, p84, p85, p86, p87, p88, p89, p90, p91,
            p92, p93, p94, p95, p96
        from
            dr_event_power_base
        where event_id = #{eventId} and org_no = #{orgNo}

    </select>

    <select id="getEventPowerToday" resultType="com.xqxy.dr.modular.event.result.EventPowerResult" parameterType="com.xqxy.dr.modular.event.param.EventParam">
        select
            *
        from
            dr_event_power
        <where>
            <if test="eventId != null and eventId != '' ">
                and event_id = #{eventId}
            </if>
            <if test="orgNo != null and orgNo != '' ">
                and org_no = #{orgNo}
            </if>
        </where>
        group by event_id
    </select>

    <select id="getEvent" resultType="com.xqxy.dr.modular.event.entity.Event" parameterType="String">
        SELECT
            *
        FROM
            dr_event
        WHERE
            event_status IN ( '03', '04' )
            AND baseline_status = 'N'
            AND REGULATE_DATE = #{regulateDate}
        ORDER BY baseline_num
        limit 1
    </select>

    <select id="getCurveHistory" parameterType="Map" resultType="com.xqxy.dr.modular.data.entity.ConsCurve">
        SELECT
        SUM( dccb.p1 ) AS p1,
        SUM( dccb.p2 ) AS p2,
        SUM( dccb.p3 ) AS p3,
        SUM( dccb.p4 ) AS p4,
        SUM( dccb.p5 ) AS p5,
        SUM( dccb.p6 ) AS p6,
        SUM( dccb.p7 ) AS p7,
        SUM( dccb.p8 ) AS p8,
        SUM( dccb.p9 ) AS p9,
        SUM( dccb.p10 ) AS p10,
        SUM( dccb.p11 ) AS p11,
        SUM( dccb.p12 ) AS p12,
        SUM( dccb.p13 ) AS p13,
        SUM( dccb.p14 ) AS p14,
        SUM( dccb.p15 ) AS p15,
        SUM( dccb.p16 ) AS p16,
        SUM( dccb.p17 ) AS p17,
        SUM( dccb.p18 ) AS p18,
        SUM( dccb.p19 ) AS p19,
        SUM( dccb.p20 ) AS p20,
        SUM( dccb.p21 ) AS p21,
        SUM( dccb.p22 ) AS p22,
        SUM( dccb.p23 ) AS p23,
        SUM( dccb.p24 ) AS p24,
        SUM( dccb.p25 ) AS p25,
        SUM( dccb.p26 ) AS p26,
        SUM( dccb.p27 ) AS p27,
        SUM( dccb.p28 ) AS p28,
        SUM( dccb.p29 ) AS p29,
        SUM( dccb.p30 ) AS p30,
        SUM( dccb.p31 ) AS p31,
        SUM( dccb.p32 ) AS p32,
        SUM( dccb.p33 ) AS p33,
        SUM( dccb.p34 ) AS p34,
        SUM( dccb.p35 ) AS p35,
        SUM( dccb.p36 ) AS p36,
        SUM( dccb.p37 ) AS p37,
        SUM( dccb.p38 ) AS p38,
        SUM( dccb.p39 ) AS p39,
        SUM( dccb.p40 ) AS p40,
        SUM( dccb.p41 ) AS p41,
        SUM( dccb.p42 ) AS p42,
        SUM( dccb.p43 ) AS p43,
        SUM( dccb.p44 ) AS p44,
        SUM( dccb.p45 ) AS p45,
        SUM( dccb.p46 ) AS p46,
        SUM( dccb.p47 ) AS p47,
        SUM( dccb.p48 ) AS p48,
        SUM( dccb.p49 ) AS p49,
        SUM( dccb.p50 ) AS p50,
        SUM( dccb.p51 ) AS p51,
        SUM( dccb.p52 ) AS p52,
        SUM( dccb.p53 ) AS p53,
        SUM( dccb.p54 ) AS p54,
        SUM( dccb.p55 ) AS p55,
        SUM( dccb.p56 ) AS p56,
        SUM( dccb.p57 ) AS p57,
        SUM( dccb.p58 ) AS p58,
        SUM( dccb.p59 ) AS p59,
        SUM( dccb.p60 ) AS p60,
        SUM( dccb.p61 ) AS p61,
        SUM( dccb.p62 ) AS p62,
        SUM( dccb.p63 ) AS p63,
        SUM( dccb.p64 ) AS p64,
        SUM( dccb.p65 ) AS p65,
        SUM( dccb.p66 ) AS p66,
        SUM( dccb.p67 ) AS p67,
        SUM( dccb.p68 ) AS p68,
        SUM( dccb.p69 ) AS p69,
        SUM( dccb.p70 ) AS p70,
        SUM( dccb.p71 ) AS p71,
        SUM( dccb.p72 ) AS p72,
        SUM( dccb.p73 ) AS p73,
        SUM( dccb.p74 ) AS p74,
        SUM( dccb.p75 ) AS p75,
        SUM( dccb.p76 ) AS p76,
        SUM( dccb.p77 ) AS p77,
        SUM( dccb.p78 ) AS p78,
        SUM( dccb.p79 ) AS p79,
        SUM( dccb.p80 ) AS p80,
        SUM( dccb.p81 ) AS p81,
        SUM( dccb.p82 ) AS p82,
        SUM( dccb.p83 ) AS p83,
        SUM( dccb.p84 ) AS p84,
        SUM( dccb.p85 ) AS p85,
        SUM( dccb.p86 ) AS p86,
        SUM( dccb.p87 ) AS p87,
        SUM( dccb.p88 ) AS p88,
        SUM( dccb.p89 ) AS p89,
        SUM( dccb.p90 ) AS p90,
        SUM( dccb.p91 ) AS p91,
        SUM( dccb.p92 ) AS p92,
        SUM( dccb.p93 ) AS p93,
        SUM( dccb.p94 ) AS p94,
        SUM( dccb.p95 ) AS p95,
        SUM( dccb.p96 ) AS p96
        FROM
        (
        SELECT
        dccb.*
        FROM
        dr_cons AS de
        LEFT JOIN dr_plan_cons dci ON dci.CONS_ID = de.id
        LEFT JOIN dr_plan p ON p.PLAN_ID = dci.PLAN_ID
        LEFT JOIN dr_cons_baseline_all AS dccb ON de.id = dccb.cons_id
        AND p.BASELIN_ID = dccb.baseline_lib_id
        WHERE
        1 = 1
        <if test="map.orgs != null and map.orgs.size > 0">
            and de.ORG_NO in
            <foreach collection="map.orgs" item="orgNo" open="(" close=")" separator=",">
                #{orgNo}
            </foreach>
        </if>
        AND p.REGULATE_ID = #{map.eventId}
        AND dci.INVOLVED_IN = 'Y'
        AND dci.IMPLEMENT = 'Y' UNION ALL
        SELECT
        dccb.*
        FROM
        dr_cons AS de
        LEFT JOIN dr_plan_cons dci ON dci.CONS_ID = de.id
        LEFT JOIN dr_plan p ON p.PLAN_ID = dci.PLAN_ID
        LEFT JOIN dr_cons_baseline AS dccb ON de.id = dccb.cons_id
        AND p.BASELIN_ID = dccb.baseline_lib_id
        WHERE
        1 = 1
        <if test="map.orgs != null and map.orgs.size > 0">
            and de.ORG_NO in
            <foreach collection="map.orgs" item="orgNo" open="(" close=")" separator=",">
                #{orgNo}
            </foreach>
        </if>
        AND p.REGULATE_ID = #{map.eventId}
        AND dci.INVOLVED_IN = 'Y'
        AND dci.IMPLEMENT = 'Y'
        AND dccb.cons_id NOT IN (
        SELECT
        dccb.cons_id
        FROM
        dr_cons AS de
        LEFT JOIN dr_plan_cons dci ON dci.CONS_ID = de.id
        LEFT JOIN dr_plan p ON p.PLAN_ID = dci.PLAN_ID
        LEFT JOIN dr_cons_baseline_all AS dccb ON de.id = dccb.cons_id
        AND p.BASELIN_ID = dccb.baseline_lib_id
        WHERE
        1 = 1
        <if test="map.orgs != null and map.orgs.size > 0">
            and de.ORG_NO in
            <foreach collection="map.orgs" item="orgNo" open="(" close=")" separator=",">
                #{orgNo}
            </foreach>
        </if>
        AND p.REGULATE_ID = #{map.eventId}
        AND dci.INVOLVED_IN = 'Y'
        AND dci.IMPLEMENT = 'Y'
        AND dccb.cons_id is not null
        )
        ) dccb
    </select>

    <select id="getEventPowerByEventAndOrg" resultType="com.xqxy.dr.modular.event.result.EventPowerResult">
        select
            *
        from
        dr_event_power
        <where>
            <if test="eventId != null and eventId != '' ">
                and event_id = #{eventId}
            </if>
            <if test="orgNo != null and orgNo != '' ">
                and org_no = #{orgNo}
            </if>
        </where>
    </select>

</mapper>
