<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xqxy.dr.modular.prediction.mapper.ConsAbilityMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.xqxy.dr.modular.prediction.entity.ConsAbility">
        <id column="DATA_POINT_ID" property="dataPointId" />
        <result column="CONS_ID" property="consId" />
        <result column="STAT_DATE" property="statDate" />
        <result column="P1" property="p1" />
        <result column="P2" property="p2" />
        <result column="P3" property="p3" />
        <result column="P4" property="p4" />
        <result column="P5" property="p5" />
        <result column="P6" property="p6" />
        <result column="P7" property="p7" />
        <result column="P8" property="p8" />
        <result column="P9" property="p9" />
        <result column="P10" property="p10" />
        <result column="P11" property="p11" />
        <result column="P12" property="p12" />
        <result column="P13" property="p13" />
        <result column="P14" property="p14" />
        <result column="P15" property="p15" />
        <result column="P16" property="p16" />
        <result column="P17" property="p17" />
        <result column="P18" property="p18" />
        <result column="P19" property="p19" />
        <result column="P20" property="p20" />
        <result column="P21" property="p21" />
        <result column="P22" property="p22" />
        <result column="P23" property="p23" />
        <result column="P24" property="p24" />
        <result column="P25" property="p25" />
        <result column="P26" property="p26" />
        <result column="P27" property="p27" />
        <result column="P28" property="p28" />
        <result column="P29" property="p29" />
        <result column="P30" property="p30" />
        <result column="P31" property="p31" />
        <result column="P32" property="p32" />
        <result column="P33" property="p33" />
        <result column="P34" property="p34" />
        <result column="P35" property="p35" />
        <result column="P36" property="p36" />
        <result column="P37" property="p37" />
        <result column="P38" property="p38" />
        <result column="P39" property="p39" />
        <result column="P40" property="p40" />
        <result column="P41" property="p41" />
        <result column="P42" property="p42" />
        <result column="P43" property="p43" />
        <result column="P44" property="p44" />
        <result column="P45" property="p45" />
        <result column="P46" property="p46" />
        <result column="P47" property="p47" />
        <result column="P48" property="p48" />
        <result column="P49" property="p49" />
        <result column="P50" property="p50" />
        <result column="P51" property="p51" />
        <result column="P52" property="p52" />
        <result column="P53" property="p53" />
        <result column="P54" property="p54" />
        <result column="P55" property="p55" />
        <result column="P56" property="p56" />
        <result column="P57" property="p57" />
        <result column="P58" property="p58" />
        <result column="P59" property="p59" />
        <result column="P60" property="p60" />
        <result column="P61" property="p61" />
        <result column="P62" property="p62" />
        <result column="P63" property="p63" />
        <result column="P64" property="p64" />
        <result column="P65" property="p65" />
        <result column="P66" property="p66" />
        <result column="P67" property="p67" />
        <result column="P68" property="p68" />
        <result column="P69" property="p69" />
        <result column="P70" property="p70" />
        <result column="P71" property="p71" />
        <result column="P72" property="p72" />
        <result column="P73" property="p73" />
        <result column="P74" property="p74" />
        <result column="P75" property="p75" />
        <result column="P76" property="p76" />
        <result column="P77" property="p77" />
        <result column="P78" property="p78" />
        <result column="P79" property="p79" />
        <result column="P80" property="p80" />
        <result column="P81" property="p81" />
        <result column="P82" property="p82" />
        <result column="P83" property="p83" />
        <result column="P84" property="p84" />
        <result column="P85" property="p85" />
        <result column="P86" property="p86" />
        <result column="P87" property="p87" />
        <result column="P88" property="p88" />
        <result column="P89" property="p89" />
        <result column="P90" property="p90" />
        <result column="P91" property="p91" />
        <result column="P92" property="p92" />
        <result column="P93" property="p93" />
        <result column="P94" property="p94" />
        <result column="P95" property="p95" />
        <result column="P96" property="p96" />
        <result column="regulatory_type" property="regulatoryType" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        DATA_POINT_ID, CONS_ID, STAT_DATE, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20, P21, P22, P23, P24, P25, P26, P27, P28, P29, P30, P31, P32, P33, P34, P35, P36, P37, P38, P39, P40, P41, P42, P43, P44, P45, P46, P47, P48, P49, P50, P51, P52, P53, P54, P55, P56, P57, P58, P59, P60, P61, P62, P63, P64, P65, P66, P67, P68, P69, P70, P71, P72, P73, P74, P75, P76, P77, P78, P79, P80, P81, P82, P83, P84, P85, P86, P87, P88, P89, P90, P91, P92, P93, P94, P95, P96, regulatory_type
    </sql>

    <sql id="Comm_Column">
        P1 p1,        P2 p2,          P3 p3,        P4 p4,        P5 p5,        P6 p6,        P7 p7,        P8 p8,
        P9 p9,        P10 p10,        P11 p11,        P12 p12,        P13 p13,        P14 p14,        P15 p15,        P16 p16,
        P17 p17,      P18 p18,        P19 p19,        P20 p20,        P21 p21,        P22 p22,        P23 p23,        P24 p24,
        P25 p25,      P26 p26,        P27 p27,        P28 p28,        P29 p29,        P30 p30,        P31 p31,        P32 p32,
        P33 p33,      P34 p34,        P35 p35,        P36 p36,        P37 p37,        P38 p38,        P39 p39,        P40 p40,
        P41 p41,      P42 p42,        P43 p43,        P44 p44,        P45 p45,        P46 p46,        P47 p47,        P48 p48,
        P49 p49,      P50 p50,        P51 p51,        P52 p52,        P53 p53,        P54 p54,        P55 p55,        P56 p56,
        P57 p57,      P58 p58,        P59 p59,        P60 p60,        P61 p61,        P62 p62,        P63 p63,        P64 p64,
        P65 p65,      P66 p66,        P67 p67,        P68 p68,        P69 p69,        P70 p70,        P71 p71,        P72 p72,
        P73 p73,      P74 p74,        P75 p75,        P76 p76,        P77 p77,        P78 p78,        P79 p79,        P80 p80,
        P81 p81,      P82 p82,        P83 p83,        P84 p84,        P85 p85,        P86 p86,        P87 p87,        P88 p88,
        P89 p89,      P90 p90,        P91 p91,        P92 p92,        P93 p93,        P94 p94,        P95 p95,        P96 p96
    </sql>

    <sql id="Sum_Comm_Column">
        sum(P1) p1,        sum(P2) p2,        sum(P3) p3,        sum(P4) p4,        sum(P5) p5,        sum(P6) p6,        sum(P7) p7,        sum(P8) p8,
        sum(P9) p9,        sum(P10) p10,        sum(P11) p11,        sum(P12) p12,        sum(P13) p13,        sum(P14) p14,        sum(P15) p15,        sum(P16) p16,
        sum(P17) p17,      sum(P18) p18,        sum(P19) p19,        sum(P20) p20,        sum(P21) p21,        sum(P22) p22,        sum(P23) p23,        sum(P24) p24,
        sum(P25) p25,      sum(P26) p26,        sum(P27) p27,        sum(P28) p28,        sum(P29) p29,        sum(P30) p30,        sum(P31) p31,        sum(P32) p32,
        sum(P33) p33,      sum(P34) p34,        sum(P35) p35,        sum(P36) p36,        sum(P37) p37,        sum(P38) p38,        sum(P39) p39,        sum(P40) p40,
        sum(P41) p41,      sum(P42) p42,        sum(P43) p43,        sum(P44) p44,        sum(P45) p45,        sum(P46) p46,        sum(P47) p47,        sum(P48) p48,
        sum(P49) p49,      sum(P50) p50,        sum(P51) p51,        sum(P52) p52,        sum(P53) p53,        sum(P54) p54,        sum(P55) p55,        sum(P56) p56,
        sum(P57) p57,      sum(P58) p58,        sum(P59) p59,        sum(P60) p60,        sum(P61) p61,        sum(P62) p62,        sum(P63) p63,        sum(P64) p64,
        sum(P65) p65,      sum(P66) p66,        sum(P67) p67,        sum(P68) p68,        sum(P69) p69,        sum(P70) p70,        sum(P71) p71,        sum(P72) p72,
        sum(P73) p73,      sum(P74) p74,        sum(P75) p75,        sum(P76) p76,        sum(P77) p77,        sum(P78) p78,        sum(P79) p79,        sum(P80) p80,
        sum(P81) p81,      sum(P82) p82,        sum(P83) p83,        sum(P84) p84,        sum(P85) p85,        sum(P86) p86,        sum(P87) p87,        sum(P88) p88,
        sum(P89) p89,      sum(P90) p90,        sum(P91) p91,        sum(P92) p92,        sum(P93) p93,        sum(P94) p94,        sum(P95) p95,        sum(P96) p96
    </sql>

    <sql id="selectSum">
        select
        max(cal_rule) calRule,
        <include refid="Sum_Comm_Column"></include>
        from dr_cons_baseline
    </sql>

    <sql id="select">
        select
        baseline_id baselineId,
        cons_id consId,
        baseline_date baselineDate,
        cal_rule calRule,
        <include refid="Comm_Column"></include>
        from dr_cons_baseline
    </sql>

    <select id="loadConsCurveBase" resultType="com.xqxy.dr.modular.prediction.param.ConsCurveBase">
        <include refid="select"/>
        where 1=1
        <!-- 用户编号 -->
        <if test="consId != null and consId!='' ">
                AND cons_id = #{consId}
        </if>
        <!-- 统计日期 -->
        <if test="statDate != null and statDate!='' ">
            AND baseline_date = #{statDate}
        </if>
        AND cal_rule in ("1")
    </select>

    <select id="queryByConsIdAndStatDate" resultType="com.xqxy.dr.modular.prediction.param.ConsAbilityParam">
        select
            `DATA_POINT_ID` dataPointId,  `CONS_ID` consId,   `STAT_DATE` statDate,  `REGULATORY_TYPE` regulatoryType,
            <include refid="Comm_Column"></include>
        from dr_cons_ability where 1=1
            <if test="consId !=null">
                and cons_id = #{consId}
            </if>
            <if test="statDate != null and statDate !=''">
                and stat_date LIKE CONCAT ("%", #{statDate}, "%")
            </if>
    </select>

    <select id="sumByArea" resultType="com.xqxy.dr.modular.prediction.param.AreaCurveBase">
        <include refid="selectSum"></include>
        WHERE 1=1
        AND CONS_ID IN
        (
            SELECT id FROM dr_cons WHERE 1=1
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='PROVINCE_CODE'">
                AND PROVINCE_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='CITY_CODE'">
                AND CITY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='COUNTY_CODE'">
                AND COUNTY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='STREET_CODE'">
                AND STREET_CODE = #{areaId}
            </if>
        )
        <if test="statDate != null and statDate!='' ">
            AND baseline_date = #{statDate}
        </if>
        <!--
             (SELECT id from dr_cons WHERE 1=1
             <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null">
                 AND #{areaType} = #{areaId}
             </if>
             <if test="areaIds != null and areaIds.size > 0">
                 AND province_code in
                 <foreach collection="areaIds" index="index" item="areaId" open="(" separator="," close=")">
                     #{areaId}
                 </foreach>
             </if>
             <if test="electricalAreaIds != null and electricalAreaIds.size > 0">
                 AND ELEC_AREA_ID in
                 <foreach collection="electricalAreaIds" index="index" item="electricalAreaId" open="(" separator=","
                          close=")">
                     #{electricalAreaId}
                 </foreach>
             </if>
         )-->

    </select>

    <select id="sumByAreaIdsAndStatDate" resultType="com.xqxy.dr.modular.prediction.param.AreaAbility">
        select
            <include refid="Sum_Comm_Column"></include>
        from dr_cons_ability where 1=1
        AND CONS_ID IN
        (
            SELECT id FROM dr_cons WHERE 1=1
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='PROVINCE_CODE'">
                AND PROVINCE_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='CITY_CODE'">
                AND CITY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='COUNTY_CODE'">
                AND COUNTY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='STREET_CODE'">
                AND STREET_CODE = #{areaId}
            </if>
        )
        <if test="statDate != null and statDate!='' ">
            AND stat_date = #{statDate}
        </if>
        AND regulatory_type = #{regulatoryType}
    </select>

    <select id="sumCurveByArea" resultType="com.xqxy.dr.modular.prediction.param.AreaCurve" parameterType="com.xqxy.dr.modular.prediction.param.ConsCurveParam">
        select
            max(DATA_POINT_FLAG) dataPointFlag,
            <include refid="Sum_Comm_Column"></include>
        from dr_cons_curve
        where 1=1
        AND CONS_ID IN
        (
            SELECT id FROM dr_cons WHERE 1=1
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='PROVINCE_CODE'">
                AND PROVINCE_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='CITY_CODE'">
                AND CITY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='COUNTY_CODE'">
                AND COUNTY_CODE = #{areaId}
            </if>
            <if test="areaId != null and areaId !='' and areaType !='' and areaType !=null and areaType=='STREET_CODE'">
                AND STREET_CODE = #{areaId}
            </if>
        )
        <if test="statDate != null and statDate!='' ">
            AND data_date = #{statDate}
        </if>
    </select>

</mapper>
